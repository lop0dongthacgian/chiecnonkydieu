<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chiếc Nón Kỳ Diệu - Family & Friends</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="game-wrapper">
    <header>
      <h1>Chiếc Nón Kỳ Diệu</h1>
    </header>

    <div class="main-content">
      <div class="right-panel">
        <div id="players">
          <div class="player active" id="player1">
            <h3>Người Chơi</h3>
            <p>Điểm: <span id="score1">0</span></p>
          </div>
        </div>

        <div id="guessInputContainer">
          <label for="guessLetter" id="guessInputLabel"><strong>Nhập ký tự:</strong></label>
          <input type="text" id="guessLetter" maxlength="1" autofocus/>
          <div class="guess-buttons">
            <button onclick="submitGuess()">ĐOÁN</button>
            <button id="buyLetterButton" onclick="buyLetter()">MUA CHỮ (500đ)</button>
          </div>
        </div>
      </div>

      <div class="left-panel">
        <div id="question"></div>
        <div class="answer-container" id="answerContainer"></div>

        <div id="wheel-container">
          <div id="wheel"></div>
          <button id="spinButton" onclick="spinWheel()">QUAY</button>
          <div id="resultOverlay"></div>
        </div>
      </div>
    </div>
  </div>

  <div id="gameNotification" class="info"></div>
  <button id="musicToggle" class="paused">Mở nhạc</button>

  <footer>
    <p>&copy; 2025 - Lớp học 0 đồng Trung Bình A3</p>
  </footer>

  <audio id="backgroundMusic" loop>
    <source src="nhacnen.mp3" type="audio/mpeg">
    Trình duyệt của bạn không hỗ trợ phần tử audio.
  </audio>

  <script src="questions.js"></script>
  <script>
    const segments = [
      { text: "100", color: "#FFD700" }, // Vàng (Gold)
      { text: "200", color: "#FF6347" }, // Đỏ cà chua (Tomato)
      { text: "300", color: "#6A5ACD" }, // Xanh tím (SlateBlue)
      { text: "400", color: "#32CD32" }, // Xanh lá chanh (LimeGreen)
      { text: "500", color: "#1E90FF" }, // Xanh dương đậm (DodgerBlue)
      { text: "600", color: "#FF1493" }, // Hồng đậm (DeepPink)
      { text: "700", color: "#BA55D3" }, // Tím nhạt (MediumOrchid)
      { text: "800", color: "#00CED1" }, // Xanh ngọc lam (DarkTurquoise)
      { text: "900", color: "#FFA500" }, // Cam (Orange)
      { text: "1000", color: "#8B008B" }, // Tím đậm (DarkMagenta)
      { text: "May mắn", color: "#ADFF2F" }, // Xanh lá cây vàng (GreenYellow)
      { text: "Nhân đôi", color: "#FFFF00" },  // Vàng tinh khiết (Yellow)
      { text: "Đoán chữ", color: "#FF4500" } // Cam đỏ (OrangeRed) - Đổi màu để nổi bật hơn
    ];

    const wheel = document.getElementById("wheel");
    const resultOverlay = document.getElementById("resultOverlay");
    const questionElement = document.getElementById("question");
    const answerContainer = document.getElementById("answerContainer");
    const guessInputContainer = document.getElementById("guessInputContainer");
    const guessInput = document.getElementById("guessLetter");
    const guessInputLabel = document.getElementById("guessInputLabel");
    const guessSubmitBtn = document.querySelector("#guessInputContainer .guess-buttons button:first-child"); // Lấy nút ĐOÁN
    const buyLetterButton = document.getElementById("buyLetterButton");

    const gameNotification = document.getElementById("gameNotification");

    const backgroundMusic = document.getElementById("backgroundMusic");
    const musicToggleBtn = document.getElementById("musicToggle");

    let currentQuestion;
    let answer;
    let plainAnswer;
    let revealedLetters;
    
    let currentPlayer = 1; // Luôn là người chơi 1
    let currentSpinValue = null;
    let scores = [0]; // Chỉ có 1 người chơi
    let currentAngle = 0;
    let spinning = false;

    let isGuessingLetter = false;
    let isGuessingFullAnswer = false;

    let availableQuestionIndices = []; // Lưu trữ các chỉ số câu hỏi còn lại
    let askedQuestionIndices = []; // Lưu trữ các chỉ số câu hỏi đã hỏi

    let isMusicPlaying = false; 
    let hasUserInteracted = false; // Biến mới để theo dõi tương tác người dùng

    // --- Chức năng nhạc nền ---
    function toggleMusic() {
        if (!hasUserInteracted && !isMusicPlaying) {
            backgroundMusic.volume = 0.5;
            backgroundMusic.play().then(() => {
                isMusicPlaying = true;
                hasUserInteracted = true;
                musicToggleBtn.classList.remove('paused');
                musicToggleBtn.classList.add('playing');
                musicToggleBtn.textContent = 'Tắt nhạc';
            }).catch(e => {
                console.warn("Lỗi khi cố gắng phát nhạc lần đầu qua nút:", e);
                showNotification("Trình duyệt chặn tự động phát nhạc. Vui lòng thử lại hoặc cho phép phát media.", 5000, 'error');
            });
        } else {
            if (isMusicPlaying) {
                backgroundMusic.pause();
                musicToggleBtn.classList.remove('playing');
                musicToggleBtn.classList.add('paused');
                musicToggleBtn.textContent = 'Mở nhạc';
                isMusicPlaying = false;
            } else {
                backgroundMusic.play().then(() => {
                    isMusicPlaying = true;
                    musicToggleBtn.classList.remove('paused');
                    musicToggleBtn.classList.add('playing');
                    musicToggleBtn.textContent = 'Tắt nhạc';
                }).catch(e => {
                    console.warn("Lỗi khi cố gắng phát nhạc qua nút:", e);
                    showNotification("Không thể phát nhạc. Vui lòng kiểm tra cài đặt trình duyệt.", 5000, 'error');
                });
            }
        }
    }

    musicToggleBtn.addEventListener('click', toggleMusic);

    function showNotification(message, duration = 3000, type = 'info') {
        if (gameNotification.timeoutId) {
            clearTimeout(gameNotification.timeoutId);
        }

        gameNotification.textContent = message;
        gameNotification.className = `info ${type}`;
        gameNotification.classList.add('show');

        gameNotification.timeoutId = setTimeout(() => {
            gameNotification.classList.remove('show');
            gameNotification.addEventListener('transitionend', function handler() {
                gameNotification.className = 'info';
                gameNotification.removeEventListener('transitionend', handler);
            }, { once: true });
        }, duration);
    }

    function getRandomQuestionIndex() {
        if (availableQuestionIndices.length === 0) {
            // Nếu đã hỏi hết tất cả câu hỏi, có thể bắt đầu lại hoặc kết thúc trò chơi
            if (allQuestions.length > 0) {
                showNotification("Bạn đã hoàn thành tất cả các câu hỏi! Bắt đầu lại bộ câu hỏi.", 3000, 'info');
                // Đặt lại danh sách câu hỏi có sẵn để chơi lại
                for (let i = 0; i < allQuestions.length; i++) {
                    availableQuestionIndices.push(i);
                }
                askedQuestionIndices = []; // Đặt lại danh sách câu hỏi đã hỏi
            } else {
                return -1; // Không có câu hỏi nào để bắt đầu
            }
        }
        const randomIndex = Math.floor(Math.random() * availableQuestionIndices.length);
        const questionActualIndex = availableQuestionIndices.splice(randomIndex, 1)[0];
        askedQuestionIndices.push(questionActualIndex);
        return questionActualIndex;
    }

    function initializeGame() {
      // Nếu là lần đầu hoặc đã hết câu hỏi, nạp lại danh sách câu hỏi
      if (availableQuestionIndices.length === 0 && askedQuestionIndices.length === 0) {
          for (let i = 0; i < allQuestions.length; i++) {
              availableQuestionIndices.push(i);
          }
      }

      const nextQuestionActualIndex = getRandomQuestionIndex();

      if (nextQuestionActualIndex === -1) {
        endGame();
        return;
      }

      currentQuestion = allQuestions[nextQuestionActualIndex];
      answer = currentQuestion.answer;
      plainAnswer = currentQuestion.plainAnswer;
      revealedLetters = Array(answer.length).fill(null);

      // Điền các khoảng trắng mặc định
      answer.forEach((char, index) => {
        if (char === " ") {
          revealedLetters[index] = char;
        }
      });

      questionElement.innerHTML = `<strong>Câu hỏi (${askedQuestionIndices.length}/${allQuestions.length}):</strong> ${currentQuestion.question}`;
      renderAnswerBoxes();
      renderWheelSegments();
      updateScores();
      document.getElementById("spinButton").disabled = false;
      guessInputContainer.style.display = "none";
      resultOverlay.style.display = "none";

      document.getElementById("player1").classList.add("active");
      showNotification(`Bắt đầu câu hỏi mới! Mời bạn quay nón.`, 3000, 'info');
      updateBuyLetterButtonState(); // Cập nhật trạng thái nút "Mua chữ"
    }

    function renderAnswerBoxes() {
      answerContainer.innerHTML = '';
      let currentGroup = document.createElement("div");
      currentGroup.className = "answer-group";

      answer.forEach((char, index) => {
        if (char === " ") {
          answerContainer.appendChild(currentGroup);
          const spaceDiv = document.createElement("div");
          spaceDiv.className = "word-space"; // Dùng class để định kiểu khoảng cách từ
          answerContainer.appendChild(spaceDiv);
          currentGroup = document.createElement("div");
          currentGroup.className = "answer-group";
        } else {
          const box = document.createElement("div");
          box.className = "letter-box";
          box.id = `box-${index}`;
          box.innerText = revealedLetters[index] || '';
          if (revealedLetters[index] !== null && revealedLetters[index] !== " ") {
            box.classList.add("revealed");
          }
          currentGroup.appendChild(box);
        }
      });
      if (currentGroup.children.length > 0) {
        answerContainer.appendChild(currentGroup);
      }
    }

    function renderWheelSegments() {
      wheel.innerHTML = '';
      const numSegments = segments.length;
      const anglePerSegment = 360 / numSegments;

      segments.forEach((seg, i) => {
        const segmentDiv = document.createElement("div");
        segmentDiv.className = "segment";
        segmentDiv.style.backgroundColor = seg.color;
        
        // Điều chỉnh skewY để tạo hình tam giác đúng
        const skewYValue = 90 - (anglePerSegment / 2);
        segmentDiv.style.transform = `rotate(${i * anglePerSegment}deg) skewY(${skewYValue}deg)`;
        
        // Sử dụng clip-path cho hình tam giác
        segmentDiv.style.clipPath = `polygon(0% 0%, 100% 50%, 0% 100%)`;

        const textSpan = document.createElement("span");
        textSpan.innerText = seg.text;
        // Xoay ngược lại skewY và xoay một nửa góc segment để chữ thẳng
        textSpan.style.transform = `skewY(-${skewYValue}deg) rotate(${anglePerSegment / 2}deg)`;
        segmentDiv.appendChild(textSpan);
        wheel.appendChild(segmentDiv);
      });
    }

    function spinWheel() {
      if (spinning) return;
      spinning = true;
      document.getElementById("spinButton").disabled = true;
      guessInput.disabled = true; // Vô hiệu hóa input khi quay
      guessSubmitBtn.disabled = true; // Vô hiệu hóa nút đoán
      buyLetterButton.disabled = true; // Vô hiệu hóa nút mua chữ

      resultOverlay.style.display = "none";
      guessInputContainer.style.display = "none";

      if (!hasUserInteracted && !isMusicPlaying) {
          backgroundMusic.volume = 0.5;
          backgroundMusic.play().then(() => {
              isMusicPlaying = true;
              hasUserInteracted = true;
              musicToggleBtn.classList.remove('paused');
              musicToggleBtn.classList.add('playing');
              musicToggleBtn.textContent = 'Tắt nhạc';
              showNotification("Nhạc đã được bật!", 2000, 'success');
          }).catch(e => {
              console.warn("Lỗi khi cố gắng phát nhạc lần đầu qua nút quay:", e);
              showNotification("Trình duyệt chặn tự động phát nhạc. Vui lòng nhấn nút 'Mở nhạc' ở góc dưới để bật.", 5000, 'error');
          });
      }


      const spinDegree = 3600 + Math.floor(Math.random() * 360);
      currentAngle += spinDegree;
      wheel.style.transition = "transform 5s cubic-bezier(0.33, 1, 0.68, 1)";
      wheel.style.transform = `rotate(${currentAngle}deg)`;

      setTimeout(() => {
        const finalAngle = currentAngle % 360;
        // Tính toán lại index cho chính xác hơn với góc cuối cùng
        let index = Math.floor((360 - (finalAngle % 360) + (360 / segments.length / 2)) / (360 / segments.length)) % segments.length;
        const result = segments[index].text;

        resultOverlay.innerText = result;
        resultOverlay.style.background = segments[index].color;
        resultOverlay.style.display = "block";

        if (!isNaN(parseInt(result))) {
          currentSpinValue = parseInt(result);
          isGuessingLetter = true;
          isGuessingFullAnswer = false;
          updateGuessInputVisibility();
          showNotification(`Kết quả: +${result}! Nhập chữ cái bạn muốn đoán.`, 3000, 'info');
        } else if (result === "Nhân đôi") {
          currentSpinValue = "double";
          isGuessingLetter = true;
          isGuessingFullAnswer = false;
          updateGuessInputVisibility();
          showNotification(`Kết quả: Nhân đôi! Nhập chữ cái bạn muốn đoán.`, 3000, 'info');
        } else if (result === "Đoán chữ") {
          isGuessingLetter = false;
          isGuessingFullAnswer = true;
          currentSpinValue = null; // Reset spin value
          updateGuessInputVisibility();
          showNotification(`Kết quả: Đoán chữ! Nhập toàn bộ đáp án.`, 3000, 'info');
        } else if (result === "May mắn") { // Xử lý ô "May mắn"
            currentSpinValue = null;
            isGuessingLetter = false;
            isGuessingFullAnswer = false;
            revealRandomLetter(); // Hàm mới để điền ngẫu nhiên 1 chữ
            showNotification(`Kết quả: May mắn! Một chữ cái đã được tiết lộ.`, 3000, 'success');
            document.getElementById("spinButton").disabled = false; // Cho phép quay lại ngay
            guessInputContainer.style.display = "none"; // Ẩn input đoán chữ
            setTimeout(() => { resultOverlay.style.display = "none"; }, 1500);
            updateBuyLetterButtonState(); // Cập nhật trạng thái nút "Mua chữ"
        } else { // Fallback, không nên xảy ra với cấu hình hiện tại
          currentSpinValue = null;
          isGuessingLetter = false;
          isGuessingFullAnswer = false;
          showNotification(`Kết quả không xác định: ${result}. Vui lòng quay lại.`, 3000, 'warning');
          document.getElementById("spinButton").disabled = false;
          guessInputContainer.style.display = "none"; // Ẩn input đoán chữ
          setTimeout(() => { resultOverlay.style.display = "none"; }, 1500);
        }

        spinning = false;

        // Cho phép input và nút đoán sau khi quay xong nếu cần đoán
        if (isGuessingLetter || isGuessingFullAnswer) {
            guessInput.disabled = false;
            guessSubmitBtn.disabled = false;
            guessInput.focus();
            setTimeout(() => { resultOverlay.style.display = "none"; }, 1500);
        } else { // Nếu không phải đoán chữ, cho phép quay lại ngay
            document.getElementById("spinButton").disabled = false;
            updateBuyLetterButtonState(); // Cập nhật trạng thái nút "Mua chữ"
        }

      }, 5000);
    }

    function updateGuessInputVisibility() {
      guessInputContainer.style.display = "block";
      guessInput.value = "";
      guessInput.focus();
      updateBuyLetterButtonState(); // Luôn cập nhật trạng thái nút "Mua chữ"

      if (isGuessingLetter) {
        guessInputLabel.innerText = "Nhập ký tự (1 chữ):";
        guessInput.maxLength = "1";
        guessInput.placeholder = "Nhập một chữ cái...";
        guessSubmitBtn.innerText = "ĐOÁN CHỮ";
        guessSubmitBtn.style.display = "inline-block";
      } else if (isGuessingFullAnswer) {
        guessInputLabel.innerText = "Nhập toàn bộ đáp án:";
        guessInput.removeAttribute("maxlength");
        guessInput.placeholder = "Nhập toàn bộ đáp án...";
        guessSubmitBtn.innerText = "ĐOÁN TOÀN BỘ";
        guessSubmitBtn.style.display = "inline-block";
      } else {
        // Nếu không cần đoán chữ, có thể ẩn input hoặc chỉ hiển thị nút mua chữ
        guessInputContainer.style.display = "none";
        guessSubmitBtn.style.display = "none";
      }
    }

    // Hàm mới: Tiết lộ một ký tự ngẫu nhiên
    function revealRandomLetter() {
        const hiddenIndices = [];
        for (let i = 0; i < revealedLetters.length; i++) {
            // Chỉ thêm vào nếu là chữ cái và chưa được tiết lộ
            if (answer[i] !== " " && revealedLetters[i] === null) {
                hiddenIndices.push(i);
            }
        }

        if (hiddenIndices.length > 0) {
            const randomIndex = hiddenIndices[Math.floor(Math.random() * hiddenIndices.length)];
            revealedLetters[randomIndex] = answer[randomIndex];
            const box = document.getElementById(`box-${randomIndex}`);
            if (box) {
                box.innerText = answer[randomIndex];
                box.classList.add("revealed");
                // Không hiển thị thông báo "May mắn" ở đây, đã hiển thị ở spinWheel
            }
            checkGameCompletion(); // Kiểm tra xem đã hoàn thành câu hỏi chưa
            return true; // Trả về true nếu một chữ cái được tiết lộ
        } else {
            showNotification("Không còn chữ cái nào để tiết lộ. Đáp án đã được mở hết.", 3000, 'info');
            return false; // Trả về false nếu không còn chữ nào để tiết lộ
        }
    }

    // Hàm mới: Mua chữ cái
    function buyLetter() {
        const COST_OF_LETTER = 500;
        if (scores[0] < COST_OF_LETTER) {
            showNotification(`Bạn không đủ ${COST_OF_LETTER} điểm để mua chữ.`, 3000, 'error');
            return;
        }

        const letterRevealed = revealRandomLetter(); // Cố gắng tiết lộ một chữ cái

        if (letterRevealed) {
            scores[0] -= COST_OF_LETTER;
            updateScores(); // Cập nhật điểm ngay sau khi trừ
            showNotification(`Bạn đã mua một chữ với giá -${COST_OF_LETTER} điểm!`, 3000, 'success');
            // Sau khi mua chữ, người chơi có thể tiếp tục quay hoặc đoán.
            // Ẩn ô input đoán chữ và cho phép quay lại ngay lập tức.
            guessInputContainer.style.display = "none";
            document.getElementById("spinButton").disabled = false; 
            updateBuyLetterButtonState(); // Cập nhật trạng thái nút sau khi mua
        } else {
            // revealRandomLetter() đã tự thông báo nếu không còn chữ để tiết lộ
            // Không trừ điểm nếu không mua được chữ nào
        }
    }

    // Hàm mới: Cập nhật trạng thái nút "Mua chữ"
    function updateBuyLetterButtonState() {
        const hiddenLettersCount = revealedLetters.filter(l => l === null && l !== " ").length; // Đếm số chữ cái chưa được tiết lộ, bỏ qua khoảng trắng
        if (scores[0] < 500 || hiddenLettersCount === 0) {
            buyLetterButton.disabled = true;
            buyLetterButton.classList.add('disabled');
        } else {
            buyLetterButton.disabled = false;
            buyLetterButton.classList.remove('disabled');
        }
    }

    function submitGuess() {
      const guess = guessInput.value.toUpperCase().trim();
      if (!guess) {
        showNotification('Vui lòng nhập nội dung đoán.', 3000, 'warning');
        return;
      }

      if (isGuessingLetter) {
        if (guess.length !== 1) {
            showNotification('Vui lòng chỉ nhập 1 ký tự để đoán chữ cái.', 3000, 'warning');
            return;
        }
        processLetterGuess(guess);
      } else if (isGuessingFullAnswer) {
        processFullAnswerGuess(guess);
      }
      
      // Sau khi đoán xong, luôn reset trạng thái và cho phép quay lại
      guessInputContainer.style.display = "none";
      document.getElementById("spinButton").disabled = false;
      guessInput.disabled = false; // Luôn re-enable input
      guessSubmitBtn.disabled = false; // Luôn re-enable nút đoán
      updateBuyLetterButtonState(); // Cập nhật trạng thái nút mua chữ
    }

    function processLetterGuess(letter) {
      const inputPlain = letter.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
      let matched = 0;
      
      for (let i = 0; i < plainAnswer.length; i++) {
        if (plainAnswer[i] === inputPlain && revealedLetters[i] === null) {
          revealedLetters[i] = answer[i];
          document.getElementById(`box-${i}`).innerText = answer[i];
          document.getElementById(`box-${i}`).classList.add("revealed");
          matched++;
        }
      }

      if (matched > 0) {
        let earned = 0;
        if (currentSpinValue === "double") {
          earned = matched * 2 * 200; // Nhân đôi điểm và số chữ cái tìm được (ví dụ)
          showNotification(`Chính xác! Bạn đoán đúng ${matched} chữ. Được x2 điểm, nhận +${earned} điểm.`, 3000, 'success');
        } else {
          earned = matched * currentSpinValue;
          showNotification(`Chính xác! Bạn đoán đúng ${matched} chữ. Nhận +${earned} điểm.`, 3000, 'success');
        }
        scores[0] += earned;
      } else {
        scores[0] -= 300;
        if (scores[0] < 0) scores[0] = 0;
        showNotification(`Sai rồi! Bạn đoán chữ '${letter}' không có hoặc đã mở. Bị trừ 300 điểm.`, 3000, 'error');
      }
      updateScores();
      isGuessingLetter = false;
      checkGameCompletion();
      document.getElementById("spinButton").disabled = false; // Cho phép quay lại ngay sau khi đoán chữ
      guessInputContainer.style.display = "none"; // Ẩn input đoán chữ
    }

    function processFullAnswerGuess(guess) {
      const normalizedGuess = guess.toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/\s/g, '');
      const normalizedCorrectAnswer = plainAnswer.filter(char => char !== " ").join("");

      if (normalizedGuess === normalizedCorrectAnswer) {
          const hiddenLettersCount = revealedLetters.filter(l => l === null).length;
          let earned = hiddenLettersCount * 100; // Mỗi chữ chưa lộ ra trị giá 100 điểm
          scores[0] += earned;
          
          for (let i = 0; i < answer.length; i++) {
              if (revealedLetters[i] === null) {
                  revealedLetters[i] = answer[i];
                  const box = document.getElementById(`box-${i}`);
                  if (box) { // Đảm bảo box tồn tại
                    box.innerText = answer[i];
                    box.classList.add("revealed");
                  }
              }
          }
          showNotification(`Chính xác! Bạn đoán đúng toàn bộ đáp án. Nhận +${earned} điểm.`, 3000, 'success');
          updateScores();
          checkGameCompletion();
      } else {
          scores[0] -= 300;
          if (scores[0] < 0) scores[0] = 0;
          showNotification(`Sai rồi! Bạn đoán sai toàn bộ đáp án. Bị trừ 300 điểm.`, 3000, 'error');
      }
      updateScores();
      isGuessingFullAnswer = false;
      document.getElementById("spinButton").disabled = false; // Cho phép quay lại ngay sau khi đoán toàn bộ
      guessInputContainer.style.display = "none"; // Ẩn input đoán chữ
    }

    function updateScores() {
      document.getElementById("score1").innerText = scores[0];
      updateBuyLetterButtonState(); // Cập nhật trạng thái nút "Mua chữ" mỗi khi điểm thay đổi
    }

    function checkGameCompletion() {
      const allLetterBoxesFilled = revealedLetters.every(char => char !== null && char !== " "); // Kiểm tra tất cả các chữ cái (không tính khoảng trắng) đã được mở chưa

      if (allLetterBoxesFilled) {
        showNotification("Tất cả các ô đã được mở! Chuyển sang câu hỏi tiếp theo.", 3000, 'info');
        setTimeout(() => {
          initializeGame();
        }, 3000); // Thời gian chờ 3 giây trước khi chuyển câu hỏi
      }
    }

    function endGame() {
      const finalScore = scores[0];
      
      document.getElementById("player1").classList.remove("active");
      document.querySelector("#player1 h3").innerText = "Trò chơi kết thúc!";
      document.querySelector("#player1 p").innerText = "Điểm cuối cùng của bạn: " + finalScore;
      
      document.getElementById("spinButton").disabled = true;
      guessInputContainer.style.display = "none";
      resultOverlay.style.display = "none";
      showNotification("Trò chơi đã kết thúc! Tổng điểm của bạn là: " + finalScore + ". Cảm ơn bạn đã tham gia.", 5000, 'info');
      updateBuyLetterButtonState(); // Vô hiệu hóa nút mua chữ khi kết thúc game
    }

    // Khởi tạo trò chơi lần đầu
    initializeGame();
  </script>
</body>
</html>
